[{"id":"74e4c992.25d51","type":"tab","label":"water_sensor","disabled":false,"info":""},{"id":"f841e824.d474f","type":"tab","label":"Lavatrice/Lavastoviglie","disabled":false,"info":""},{"id":"45dd8798.2cfc88","type":"tab","label":"xmas_light","disabled":true,"info":""},{"id":"22ed3d76.929c3a","type":"server","z":"","name":"Casa","legacy":false,"hassio":false,"rejectUnauthorizedCerts":false,"ha_boolean":"y|yes|true|on|home|open"},{"id":"c6e21e6c.847e8","type":"server","z":"","name":"Casa (local)","legacy":false,"hassio":false,"rejectUnauthorizedCerts":false,"ha_boolean":"y|yes|true|on|home|open"},{"id":"615025f1.4f06b4","type":"mqtt-broker","z":"","name":"","broker":"10.9.10.55","port":"1883","clientid":"nodered","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","closeTopic":"","closeQos":"0","closeRetain":"false","closePayload":"","willTopic":"","willQos":"0","willRetain":"false","willPayload":""},{"id":"1b399b.1c765e66","type":"server-state-changed","z":"74e4c992.25d51","name":"water1","server":"c6e21e6c.847e8","entityidfilter":"binary_sensor.water1","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":90,"y":160,"wires":[["89037470.7bfdb8"],[]]},{"id":"ad52530b.2d99","type":"api-call-service","z":"74e4c992.25d51","name":"","server":"c6e21e6c.847e8","service_domain":"notify","service":"ios_mauro_iphone","data":"{\"message\":\"E' stata rilevata una perdita d'acqua dal sensore \",\"title\":\"Attenzione perdita d'acqua {{payload}}\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":910,"y":300,"wires":[[]]},{"id":"c54846e.fe6b7b8","type":"server-state-changed","z":"74e4c992.25d51","name":"water2","server":"c6e21e6c.847e8","entityidfilter":"binary_sensor.water2","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":90,"y":240,"wires":[["89037470.7bfdb8"],[]]},{"id":"fc1ceb77.d59ce8","type":"server-state-changed","z":"74e4c992.25d51","name":"water3","server":"c6e21e6c.847e8","entityidfilter":"binary_sensor.water3","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":90,"y":320,"wires":[["89037470.7bfdb8"],[]]},{"id":"f5488a6c.31f53","type":"sunrise","z":"45dd8798.2cfc88","name":"","lat":"45.6666400","lon":"9.0488400","start":"sunriseEnd","end":"goldenHour","x":110,"y":220,"wires":[[],["3b028a67.70c13e"]],"outputLabels":["payload",""]},{"id":"3b028a67.70c13e","type":"switch","z":"45dd8798.2cfc88","name":"alba o tramonto ?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"eq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":220,"wires":[["785b1e0.5e8c7e4"],["7cb064d9.8a1514"]]},{"id":"785b1e0.5e8c7e4","type":"api-call-service","z":"45dd8798.2cfc88","name":"Accende luci di Natale","server":"c6e21e6c.847e8","service_domain":"homeassistant","service":"turn_on","data":"{\"entity_id\":\"switch.lucine_casa\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":700,"y":180,"wires":[[]]},{"id":"7cb064d9.8a1514","type":"api-call-service","z":"45dd8798.2cfc88","name":"Spegne luci di Natale","server":"c6e21e6c.847e8","service_domain":"homeassistant","service":"turn_off","data":"{\"entity_id\":\"switch.lucine_casa\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":700,"y":260,"wires":[[]]},{"id":"a8632f50.219d08","type":"server-state-changed","z":"f841e824.d474f","name":"","server":"c6e21e6c.847e8","entityidfilter":"sensor.lavatrice_watts","entityidfiltertype":"substring","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":150,"y":280,"wires":[["ae09eb3a.ae7da8"]]},{"id":"f4340b95.47f0f","type":"api-current-state","z":"f841e824.d474f","name":"Stato della lavatrice","server":"c6e21e6c.847e8","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.washingmachine_status","state_type":"str","outputs":1,"x":770,"y":200,"wires":[["fe8fbe43.1e9b3"]]},{"id":"ae09eb3a.ae7da8","type":"switch","z":"f841e824.d474f","name":"<= 2 or >2 ?","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"2","vt":"str"},{"t":"gt","v":"2","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":450,"y":280,"wires":[["f4340b95.47f0f"],["a3105e74.022858"]]},{"id":"a3105e74.022858","type":"api-current-state","z":"f841e824.d474f","name":"Stato della lavatrice","server":"c6e21e6c.847e8","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.washingmachine_status","state_type":"str","outputs":1,"x":770,"y":380,"wires":[["3f57ade6.e73e2a"]]},{"id":"3f57ade6.e73e2a","type":"switch","z":"f841e824.d474f","name":"on OR off ?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1010,"y":380,"wires":[[],["354cbbf5.235e94"]]},{"id":"fe8fbe43.1e9b3","type":"switch","z":"f841e824.d474f","name":"on OR off ?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1010,"y":200,"wires":[["360535db.0ee84a"],[]]},{"id":"354cbbf5.235e94","type":"api-call-service","z":"f841e824.d474f","name":"Imposta la lavatrice su \"on\"","server":"c6e21e6c.847e8","service_domain":"input_boolean","service":"turn_on","data":"{\"entity_id\":\"input_boolean.washingmachine_status\"}","render_data":false,"mergecontext":"","output_location":"","output_location_type":"none","x":1280,"y":380,"wires":[[]]},{"id":"360535db.0ee84a","type":"api-call-service","z":"f841e824.d474f","name":"imposta la lavatrice su \"off\"","server":"c6e21e6c.847e8","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.washingmachine_status\"}","render_data":false,"mergecontext":"","output_location":"","output_location_type":"none","x":1280,"y":200,"wires":[["be6acb78.7ef618","408a0c86.4b03b4","619d3081.d0bf38"]]},{"id":"be6acb78.7ef618","type":"api-call-service","z":"f841e824.d474f","name":"Notifica tramite Alexa","server":"c6e21e6c.847e8","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\":\"media_player.cucina\",\"message\":\"La lavatrice ha finito. Ora puoi stendere il bucato\"}","render_data":false,"mergecontext":"","output_location":"","output_location_type":"none","x":1620,"y":140,"wires":[[]]},{"id":"9bc871dc.88a4f","type":"comment","z":"45dd8798.2cfc88","name":"Xmas Light","info":"Accende/spegne le luci di Natale all'inizio dell'imbrunire e alla fine dell'alba.","x":80,"y":20,"wires":[]},{"id":"408a0c86.4b03b4","type":"api-call-service","z":"f841e824.d474f","name":"","server":"c6e21e6c.847e8","service_domain":"notify","service":"ios_mauro_iphone","data":"{\"title\":\"Bucato terminato\",\"message\":\"La lavatrice ha finito. Ora puoi stendere il bucato\"}","render_data":false,"mergecontext":"","output_location":"","output_location_type":"none","x":1650,"y":200,"wires":[[]]},{"id":"619d3081.d0bf38","type":"api-call-service","z":"f841e824.d474f","name":"","server":"c6e21e6c.847e8","service_domain":"notify","service":"ios_grazia_iphone","data":"{\"title\":\"Bucato terminato\",\"message\":\"La lavatrice ha finito. Ora puoi stendere il bucato\"}","render_data":false,"mergecontext":"","output_location":"","output_location_type":"none","x":1640,"y":260,"wires":[[]]},{"id":"2e9df7be.cb2f28","type":"inject","z":"45dd8798.2cfc88","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":460,"y":340,"wires":[["7cb064d9.8a1514"]]},{"id":"23071150.38b65e","type":"inject","z":"f841e824.d474f","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1300,"y":80,"wires":[["be6acb78.7ef618"]]},{"id":"1d3111a2.e40926","type":"inject","z":"45dd8798.2cfc88","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":460,"y":100,"wires":[["785b1e0.5e8c7e4"]]},{"id":"929f8303.a26fa8","type":"comment","z":"f841e824.d474f","name":"","info":"","x":60,"y":60,"wires":[]},{"id":"588e2549.c8940c","type":"server-state-changed","z":"74e4c992.25d51","name":"water4","server":"c6e21e6c.847e8","entityidfilter":"binary_sensor.water4","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":90,"y":400,"wires":[["89037470.7bfdb8"],[]]},{"id":"b0e3b84e.37a95","type":"debug","z":"74e4c992.25d51","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1050,"y":860,"wires":[]},{"id":"a31e1159.ae248","type":"api-current-state","z":"74e4c992.25d51","name":"water1 battery level","server":"c6e21e6c.847e8","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"binary_sensor.water1","state_type":"str","outputs":1,"x":370,"y":680,"wires":[["e58be3c0.0fe8b8"]]},{"id":"8606ccef.3740a","type":"inject","z":"74e4c992.25d51","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 12 * * *","once":false,"onceDelay":0.1,"x":90,"y":840,"wires":[["a31e1159.ae248","d3b62575.0a52f8","d05b9a31.dc043","9d315b85.112348","ecaefb70.0f3148","a804a23d.6082e8"]]},{"id":"e58be3c0.0fe8b8","type":"function","z":"74e4c992.25d51","name":"if battery level < 20","func":"var battery_level =  msg.data.attributes.battery_level;\nvar sensor_name = msg.data.attributes.friendly_name;\nif (battery_level < 20) {\nmsg.payload =  \"ATTENZIONE: livello batteria sensore \" + sensor_name + \" \" + battery_level + \"%\" \n} else { msg = null }\nreturn msg; ","outputs":1,"noerr":0,"x":810,"y":780,"wires":[["b0e3b84e.37a95"]]},{"id":"d3b62575.0a52f8","type":"api-current-state","z":"74e4c992.25d51","name":"water2 battery level","server":"c6e21e6c.847e8","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"binary_sensor.water2","state_type":"str","outputs":1,"x":370,"y":740,"wires":[["e58be3c0.0fe8b8"]]},{"id":"9d315b85.112348","type":"api-current-state","z":"74e4c992.25d51","name":"water4 battery level","server":"c6e21e6c.847e8","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"binary_sensor.water4","state_type":"str","outputs":1,"x":370,"y":860,"wires":[["e58be3c0.0fe8b8"]]},{"id":"d05b9a31.dc043","type":"api-current-state","z":"74e4c992.25d51","name":"water3 battery level","server":"22ed3d76.929c3a","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"binary_sensor.water3","state_type":"str","outputs":1,"x":370,"y":800,"wires":[["e58be3c0.0fe8b8"]]},{"id":"89037470.7bfdb8","type":"function","z":"74e4c992.25d51","name":"Modify payload with sensor name","func":"var sensor_name = msg.data.attributes.friendly_name;\nmsg.payload = \"ATTENZIONE: perdita d'acqua rilevata dal sesnore \" + sensor_name\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":280,"wires":[["ad52530b.2d99"]]},{"id":"ecaefb70.0f3148","type":"api-current-state","z":"74e4c992.25d51","name":"switch1 battery level","server":"c6e21e6c.847e8","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.switch1_battery_level","state_type":"str","outputs":1,"x":380,"y":920,"wires":[["f516de9b.ba657"]]},{"id":"a804a23d.6082e8","type":"api-current-state","z":"74e4c992.25d51","name":"switch2 battery level","server":"c6e21e6c.847e8","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.switch2_battery_level","state_type":"str","outputs":1,"x":380,"y":980,"wires":[["f516de9b.ba657"]]},{"id":"f516de9b.ba657","type":"function","z":"74e4c992.25d51","name":"if battery level < 20","func":"var battery_level =  msg.payload;\nvar sensor_name = msg.data.attributes.friendly_name;\nif (battery_level < 20) {\nmsg.payload =  \"ATTENZIONE: livello batteria sensore \" + sensor_name + \" \" + battery_level + \"%\" \n} else { msg = null }\nreturn msg; ","outputs":1,"noerr":0,"x":810,"y":940,"wires":[["b0e3b84e.37a95"]]},{"id":"ffe2d279.f93d88","type":"server-state-changed","z":"f841e824.d474f","name":"Consumo Lavastoviglie Watt","server":"c6e21e6c.847e8","entityidfilter":"sensor.innr_plug1_power","entityidfiltertype":"substring","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":140,"y":640,"wires":[["6e027ae9.8d00ec"]]},{"id":"6e027ae9.8d00ec","type":"switch","z":"f841e824.d474f","name":"<= 2 or >2 ?","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"2","vt":"str"},{"t":"gt","v":"2","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":450,"y":640,"wires":[["e3a6ed46.3e66f"],["a6f2672e.495d1"]]},{"id":"e3a6ed46.3e66f","type":"api-current-state","z":"f841e824.d474f","name":"Stato della lavastoviglie","server":"c6e21e6c.847e8","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.dishwasher_status","state_type":"str","outputs":1,"x":690,"y":580,"wires":[["3d39953f.345562"]]},{"id":"a6f2672e.495d1","type":"api-current-state","z":"f841e824.d474f","name":"Stato della lavastoviglie","server":"c6e21e6c.847e8","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.dishwasher_status","state_type":"str","outputs":1,"x":690,"y":700,"wires":[["9733f16e.52992"]]},{"id":"3d39953f.345562","type":"switch","z":"f841e824.d474f","name":"on OR off ?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":950,"y":580,"wires":[["3a8a3532.c7912a"],[]]},{"id":"9733f16e.52992","type":"switch","z":"f841e824.d474f","name":"on OR off ?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":950,"y":700,"wires":[[],["be6f3ee8.6368a"]]},{"id":"3a8a3532.c7912a","type":"api-call-service","z":"f841e824.d474f","name":"imposta la lavastoviglie su \"off\"","server":"c6e21e6c.847e8","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.dishwasher_status\"}","render_data":false,"mergecontext":"","output_location":"","output_location_type":"none","x":1250,"y":580,"wires":[["846d2ef1.3d76d"]]},{"id":"be6f3ee8.6368a","type":"api-call-service","z":"f841e824.d474f","name":"Imposta la lavastoviglie su \"on\"","server":"c6e21e6c.847e8","service_domain":"input_boolean","service":"turn_on","data":"{\"entity_id\":\"input_boolean.dishwasher_status\"}","render_data":false,"mergecontext":"","output_location":"","output_location_type":"none","x":1250,"y":700,"wires":[[]]},{"id":"846d2ef1.3d76d","type":"api-call-service","z":"f841e824.d474f","name":"","server":"c6e21e6c.847e8","service_domain":"notify","service":"ios_mauro_iphone","data":"{\"title\":\"Piatti Lavati\",\"message\":\"La lavastoviglie ha finito\"}","render_data":false,"mergecontext":"","output_location":"","output_location_type":"none","x":1600,"y":640,"wires":[[]]},{"id":"ec897701.132bc8","type":"server-state-changed","z":"f841e824.d474f","name":"Consumo Lavastoviglie Watt","server":"c6e21e6c.847e8","entityidfilter":"sensor.innr_plug2_power","entityidfiltertype":"substring","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":160,"y":1060,"wires":[["7a46ecc5.71988c"]]},{"id":"7a46ecc5.71988c","type":"switch","z":"f841e824.d474f","name":"<= 2 or >2 ?","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"2","vt":"str"},{"t":"gt","v":"2","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":450,"y":1060,"wires":[["d4975ff.140ba2"],["e897623e.1afe8"]]},{"id":"d4975ff.140ba2","type":"api-current-state","z":"f841e824.d474f","name":"Stato della lavastoviglie","server":"c6e21e6c.847e8","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.appliance_status","state_type":"str","outputs":1,"x":710,"y":1000,"wires":[["e98e9669.14b95"]]},{"id":"e897623e.1afe8","type":"api-current-state","z":"f841e824.d474f","name":"Stato della lavastoviglie","server":"c6e21e6c.847e8","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.appliance_status","state_type":"str","outputs":1,"x":710,"y":1120,"wires":[["ee2e3dc4.f589e8"]]},{"id":"e98e9669.14b95","type":"switch","z":"f841e824.d474f","name":"on OR off ?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":970,"y":1000,"wires":[["ca6f18f1.838968"],[]]},{"id":"ee2e3dc4.f589e8","type":"switch","z":"f841e824.d474f","name":"on OR off ?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":970,"y":1120,"wires":[[],["55f6a70a.014a6"]]},{"id":"ca6f18f1.838968","type":"api-call-service","z":"f841e824.d474f","name":"imposta la lavastoviglie su \"off\"","server":"c6e21e6c.847e8","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.appliance_status\"}","render_data":false,"mergecontext":"","output_location":"","output_location_type":"none","x":1270,"y":1000,"wires":[["c0343eb2.3930d8"]]},{"id":"55f6a70a.014a6","type":"api-call-service","z":"f841e824.d474f","name":"Imposta la lavastoviglie su \"on\"","server":"c6e21e6c.847e8","service_domain":"input_boolean","service":"turn_on","data":"{\"entity_id\":\"input_boolean.appliance_status\"}","render_data":false,"mergecontext":"","output_location":"","output_location_type":"none","x":1270,"y":1120,"wires":[[]]},{"id":"c0343eb2.3930d8","type":"api-call-service","z":"f841e824.d474f","name":"","server":"c6e21e6c.847e8","service_domain":"notify","service":"ios_mauro_iphone","data":"{\"title\":\"Appliance ha finito\",\"message\":\"Appliance ha finito\"}","render_data":false,"mergecontext":"","output_location":"","output_location_type":"none","x":1620,"y":1060,"wires":[[]]}]